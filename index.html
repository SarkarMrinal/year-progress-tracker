<!DOCTYPE html>
<html lang="en" class="antialiased">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Year Progress Tracker</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@400;500;600;700&display=swap"
    rel="stylesheet" />

  <script src="https://unpkg.com/lucide@latest"></script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            background: "#0A0A0F",
            backgroundAlt: "#12121A",
            surface: "#1A1A24",
            surfaceHighlight: "#242432",
            textMain: "#FAFAFA",
            textMuted: "#71717A",
            textDim: "#3F3F46",
            accent: "#F59E0B",
            accentMuted: "rgba(245, 158, 11, 0.15)",
            borderSubtle: "rgba(255, 255, 255, 0.08)",
            borderHover: "rgba(255, 255, 255, 0.15)",
            borderAccent: "rgba(245, 158, 11, 0.3)",
          },
          fontFamily: {
            sans: ["Inter", "system-ui", "sans-serif"],
            display: ["Space Grotesk", "system-ui", "sans-serif"],
            mono: ["JetBrains Mono", "monospace"],
          },
          fontSize: {
            xxs: ["0.625rem", "0.875rem"],
          },
          boxShadow: {
            "glow-xs": "0 0 10px rgba(245, 158, 11, 0.1)",
            "glow-sm": "0 0 20px rgba(245, 158, 11, 0.15)",
            "glow-md": "0 0 40px rgba(245, 158, 11, 0.2)",
            "glow-lg": "0 0 60px rgba(245, 158, 11, 0.25)",
            "inner-glow": "inset 0 0 20px rgba(245, 158, 11, 0.05)",
            glass:
              "0 8px 32px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.05)",
          },
          animation: {
            "pulse-slow": "pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite",
            float: "float 6s ease-in-out infinite",
            glow: "glow 2s ease-in-out infinite alternate",
            shimmer: "shimmer 3s infinite linear",
            "fade-in": "fadeIn 0.5s ease-out forwards",
            "slide-up": "slideUp 0.3s ease-out forwards",
          },
          keyframes: {
            float: {
              "0%, 100%": { transform: "translateY(0)" },
              "50%": { transform: "translateY(-10px)" },
            },
            glow: {
              "0%": { opacity: "0.6" },
              "100%": { opacity: "1" },
            },
            shimmer: {
              "0%": { transform: "translateX(-100%)" },
              "100%": { transform: "translateX(100%)" },
            },
            fadeIn: {
              "0%": { opacity: "0", transform: "translateY(10px)" },
              "100%": { opacity: "1", transform: "translateY(0)" },
            },
            slideUp: {
              "0%": { opacity: "0", transform: "translateY(20px)" },
              "100%": { opacity: "1", transform: "translateY(0)" },
            },
          },
          backdropBlur: {
            xs: "4px",
          },
        },
      },
    };
  </script>

  <style>
    /* Custom CSS for enhanced effects */
    body {
      background-color: #0a0a0f;
      color: #fafafa;
      /* Layered noise texture */
      background-image: radial-gradient(ellipse at 20% 20%,
          rgba(245, 158, 11, 0.03) 0%,
          transparent 50%),
        radial-gradient(ellipse at 80% 80%,
          rgba(245, 158, 11, 0.02) 0%,
          transparent 50%),
        url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.025'/%3E%3C/svg%3E");
      background-attachment: fixed;
    }

    .glass-card {
      background: linear-gradient(135deg,
          rgba(26, 26, 36, 0.8) 0%,
          rgba(18, 18, 26, 0.9) 100%);
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 400ms cubic-bezier(0.16, 1, 0.3, 1);
    }

    .glass-card:hover {
      border-color: rgba(255, 255, 255, 0.15);
      background: linear-gradient(135deg,
          rgba(26, 26, 36, 0.9) 0%,
          rgba(18, 18, 26, 0.95) 100%);
      transform: translateY(-2px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3),
        0 0 40px rgba(245, 158, 11, 0.1);
    }

    .progress-glow {
      box-shadow: 0 0 20px rgba(245, 158, 11, 0.4),
        0 0 40px rgba(245, 158, 11, 0.2),
        0 0 60px rgba(245, 158, 11, 0.1);
      animation: fire-glow 1.5s ease-in-out infinite alternate;
    }

    @keyframes fire-glow {
      0% {
        box-shadow: 0 0 15px rgba(245, 158, 11, 0.4),
          0 0 30px rgba(245, 158, 11, 0.2),
          0 0 45px rgba(245, 158, 11, 0.1);
      }

      100% {
        box-shadow: 0 0 25px rgba(245, 158, 11, 0.6),
          0 0 50px rgba(245, 158, 11, 0.3),
          0 0 75px rgba(245, 158, 11, 0.15);
      }
    }

    .progress-bar-shimmer {
      position: relative;
      overflow: visible;
    }

    .progress-bar-shimmer::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent);
      transform: translateX(-100%);
      animation: shimmer 2s infinite;
    }

    /* Fire particles at the end of progress bar */
    .progress-bar-shimmer::before {
      content: "";
      position: absolute;
      right: -2px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      background: radial-gradient(circle, rgba(255, 200, 100, 0.9) 0%, rgba(245, 158, 11, 0.6) 40%, transparent 70%);
      border-radius: 50%;
      animation: spark-pulse 0.8s ease-in-out infinite alternate;
      filter: blur(2px);
    }

    @keyframes spark-pulse {
      0% {
        transform: translateY(-50%) scale(0.8);
        opacity: 0.6;
      }

      100% {
        transform: translateY(-50%) scale(1.3);
        opacity: 1;
      }
    }

    /* Sparkle dots animation */
    .sparkle-container {
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 30px;
      height: 30px;
      pointer-events: none;
    }

    .sparkle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #fff;
      border-radius: 50%;
      animation: sparkle-fly 1.2s ease-out infinite;
      box-shadow: 0 0 6px 2px rgba(255, 200, 100, 0.8);
    }

    .sparkle:nth-child(1) {
      animation-delay: 0s;
      left: 50%;
    }

    .sparkle:nth-child(2) {
      animation-delay: 0.2s;
      left: 30%;
    }

    .sparkle:nth-child(3) {
      animation-delay: 0.4s;
      left: 70%;
    }

    .sparkle:nth-child(4) {
      animation-delay: 0.6s;
      left: 40%;
    }

    .sparkle:nth-child(5) {
      animation-delay: 0.8s;
      left: 60%;
    }

    @keyframes sparkle-fly {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }

      100% {
        transform: translateY(-25px) scale(0);
        opacity: 0;
      }
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(245, 158, 11, 0.3);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(245, 158, 11, 0.5);
    }

    /* Selection styling */
    ::selection {
      background-color: rgba(245, 158, 11, 0.4);
      color: #fafafa;
    }

    /* Focus styles for accessibility */
    *:focus-visible {
      outline: 2px solid rgba(245, 158, 11, 0.5);
      outline-offset: 2px;
    }

    /* Gradient text */
    .gradient-text {
      background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .nightlight-overlay {
      position: fixed;
      inset: 0;
      z-index: 5;
      background: rgba(255, 190, 120, 0.18);
      opacity: 0;
      transition: opacity 250ms ease;
      mix-blend-mode: multiply;
      backdrop-filter: sepia(0.28) hue-rotate(-8deg) brightness(0.94);
      pointer-events: none;
    }

    body.nightlight-active .nightlight-overlay {
      opacity: 0.3;
    }

    body.nightlight-active main {
      filter: sepia(0.15) hue-rotate(-8deg) brightness(0.95);
    }

    /* GitHub contributions */
    .gh-grid {
      display: inline-grid;
      grid-auto-flow: column;
      grid-auto-columns: 12px;
      gap: 3px;
      justify-items: center;
      align-items: start;
      justify-content: start;
      align-content: start;
    }

    .gh-week {
      display: grid;
      grid-template-rows: repeat(7, 1fr);
      gap: 2px;
      justify-items: center;
    }

    .gh-cell {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.05);
      transition: transform 120ms ease, box-shadow 120ms ease,
        background 120ms ease;
    }

    .gh-cell:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
    }

    .gh-legend {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .gh-legend-swatch {
      width: 14px;
      height: 10px;
      border-radius: 2px;
      display: inline-block;
    }

    .gh-month-cell {
      min-width: 12px;
      height: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      letter-spacing: 0.03em;
      text-align: center;
    }

    .nightlight-toggle-btn {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      padding: 0.6rem 1rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(12, 10, 20, 0.9);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.35);
      transition: transform 200ms ease, border-color 200ms ease,
        box-shadow 200ms ease;
      font-size: 0.85rem;
    }

    .nightlight-toggle-btn:hover {
      transform: translateY(-2px);
      border-color: rgba(245, 158, 11, 0.45);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }

    .nightlight-toggle-active {
      border-color: rgba(245, 158, 11, 0.5) !important;
      background-color: rgba(245, 158, 11, 0.08);
      box-shadow: 0 0 20px rgba(245, 158, 11, 0.2);
      color: #f59e0b;
    }

    .nightlight-toggle-active .nightlight-dot {
      background: #f59e0b;
      box-shadow: 0 0 10px rgba(245, 158, 11, 0.8);
    }

    body.nightlight-active .nightlight-toggle-btn {
      border-color: rgba(245, 158, 11, 0.4);
      box-shadow: 0 20px 45px rgba(245, 158, 11, 0.18);
    }

    /* Utility to disable hover lift */
    .no-hover-raise:hover {
      transform: none !important;
    }

    /* AFK Typing Animation */
    .typing-text {
      display: inline-block;
      border-right: 3px solid rgba(245, 158, 11, 0.8);
      white-space: nowrap;
      animation: blink-caret 0.6s step-end infinite;
      min-height: 1.2em;
    }

    @keyframes blink-caret {

      from,
      to {
        border-color: transparent;
      }

      50% {
        border-color: rgba(245, 158, 11, 0.8);
      }
    }

    .afk-container {
      display: inline-flex;
      align-items: center;
    }

    .afk-status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.75rem;
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 9999px;
      font-size: 0.75rem;
      color: #f59e0b;
      animation: pulse 2s ease-in-out infinite;
    }

    /* Custom Modal Styles */
    .custom-modal-overlay {
      position: fixed;
      inset: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .custom-modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .custom-modal {
      width: 90%;
      max-width: 400px;
      background: linear-gradient(135deg, rgba(26, 26, 36, 0.95) 0%, rgba(18, 18, 26, 0.98) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 60px rgba(245, 158, 11, 0.1);
      transform: scale(0.9) translateY(20px);
      transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .custom-modal-overlay.active .custom-modal {
      transform: scale(1) translateY(0);
    }

    .custom-modal-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.5rem;
      font-weight: 600;
      color: #fafafa;
      margin-bottom: 0.5rem;
    }

    .custom-modal-subtitle {
      font-size: 0.875rem;
      color: #71717a;
      margin-bottom: 1.5rem;
    }

    .custom-modal-input {
      width: 100%;
      padding: 0.875rem 1rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0.5rem;
      color: #fafafa;
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .custom-modal-input::placeholder {
      color: #3f3f46;
    }

    .custom-modal-input:focus {
      border-color: rgba(245, 158, 11, 0.5);
      box-shadow: 0 0 20px rgba(245, 158, 11, 0.15);
    }

    .custom-modal-buttons {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }

    .custom-modal-btn {
      flex: 1;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-family: 'Inter', sans-serif;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
    }

    .custom-modal-btn-primary {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: #0a0a0f;
    }

    .custom-modal-btn-primary:hover {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4);
    }

    .custom-modal-btn-secondary {
      background: rgba(255, 255, 255, 0.05);
      color: #71717a;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .custom-modal-btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #fafafa;
    }

    .custom-modal-icon {
      width: 48px;
      height: 48px;
      margin-bottom: 1rem;
      padding: 12px;
      background: rgba(245, 158, 11, 0.1);
      border-radius: 12px;
      color: #f59e0b;
    }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center relative overflow-hidden selection:bg-accent/30">
  <div id="nightlight-overlay" class="nightlight-overlay pointer-events-none"></div>

  <!-- Custom Input Modal -->
  <div id="custom-modal-overlay" class="custom-modal-overlay">
    <div class="custom-modal">
      <div id="modal-icon" class="custom-modal-icon">
        <i data-lucide="user" class="w-6 h-6"></i>
      </div>
      <h2 id="modal-title" class="custom-modal-title">Welcome!</h2>
      <p id="modal-subtitle" class="custom-modal-subtitle">Please enter your information</p>
      <input type="text" id="modal-input" class="custom-modal-input" placeholder="Enter here..." autocomplete="off" />
      <div class="custom-modal-buttons">
        <button id="modal-cancel" type="button" class="custom-modal-btn custom-modal-btn-secondary">Skip</button>
        <button id="modal-submit" type="button" class="custom-modal-btn custom-modal-btn-primary">Continue</button>
      </div>
    </div>
  </div>

  <!-- Enhanced Ambient Orbs -->
  <div
    class="absolute top-0 left-1/4 w-[600px] h-[600px] bg-accent/5 rounded-full blur-[150px] pointer-events-none mix-blend-screen opacity-50 animate-float">
  </div>
  <div
    class="absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-accent/5 rounded-full blur-[120px] pointer-events-none mix-blend-screen opacity-40">
  </div>
  <div
    class="absolute top-1/2 left-1/3 w-[300px] h-[300px] bg-accent/3 rounded-full blur-[80px] pointer-events-none mix-blend-screen opacity-30">
  </div>

  <!-- Grid Pattern -->
  <div class="absolute inset-0 opacity-[0.02] pointer-events-none" style="
        background-image: linear-gradient(
            rgba(255, 255, 255, 0.1) 1px,
            transparent 1px
          ),
          linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
        background-size: 50px 50px;
      "></div>

  <main class="relative z-10 w-full max-w-4xl px-4 py-8 md:py-16 flex flex-col gap-4 md:gap-6">
    <!-- Enhanced Header -->
    <header class="animate-fade-in mb-4">
      <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between w-full">
        <div class="flex flex-col gap-3">
          <p id="greeting" class="text-3xl md:text-4xl font-display font-semibold text-textMain tracking-tight">
            Welcome!
          </p>
        </div>
        <div class="glass-card no-hover-raise rounded-xl p-4 md:p-5 min-w-[260px] md:mt-0 mt-2">
          <div class="space-y-2.5 text-left">
            <div class="flex items-center justify-start gap-2 text-[11px] uppercase tracking-[0.16em]">
              <i data-lucide="calendar-days" class="w-4 h-4 text-textMuted"></i>
              <span class="font-mono text-[11px] text-textMuted">Today</span>
            </div>
            <div id="current-date" class="text-sm font-sans text-textMain font-medium" aria-live="polite">
              Loading...
            </div>
            <div id="current-time" class="text-3xl md:text-4xl font-mono text-accent font-semibold tracking-tight"
              aria-live="polite">
              00:00:00
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- GitHub Contributions -->
    <section class="glass-card rounded-2xl px-6 md:px-8 pb-6 md:pb-8 relative overflow-hidden group animate-slide-up"
      style="border: none; padding-top: 0;">
      <div class="absolute -top-10 -right-10 opacity-5">
        <i data-lucide="github" class="w-32 h-32 text-textMain"></i>
      </div>
      <div class="relative z-10">
        <div class="relative overflow-hidden mb-4">
          <div class="absolute -top-24 -right-24 opacity-5 pointer-events-none">
            <i data-lucide="calendar-clock" class="w-48 h-48 text-textMain"></i>
          </div>

          <div class="relative z-10">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4">
              <div class="space-y-2">
                <div class="flex items-baseline gap-3">
                  <h2 class="text-2xl md:text-3xl font-display font-semibold text-textMain leading-tight">
                    Annual Progress
                  </h2>
                  <span id="current-year" class="font-mono text-xl md:text-2xl text-accent font-medium leading-tight"
                    aria-live="polite">--</span>
                </div>

              </div>

              <div class="flex items-center gap-4 pt-2">
                <div class="text-right">
                  <div class="text-xs font-mono uppercase tracking-wider text-textMuted mb-1">
                    Completion
                  </div>
                  <div id="year-percent"
                    class="text-4xl md:text-5xl font-display font-bold gradient-text tracking-tighter">
                    0.0000%
                  </div>
                </div>
              </div>
            </div>

            <!-- Enhanced Progress Bar -->
            <div class="space-y-4">
              <div class="w-full h-4 bg-white/5 rounded-full overflow-visible border border-white/5 relative">
                <div id="year-bar"
                  class="h-full bg-gradient-to-r from-accent via-[#FBBF24] to-[#FCD34D] rounded-full progress-glow progress-bar-shimmer transition-all duration-1500 ease-out w-0 relative">
                  <!-- Sparkle container -->
                  <div class="sparkle-container">
                    <div class="sparkle"></div>
                    <div class="sparkle"></div>
                    <div class="sparkle"></div>
                    <div class="sparkle"></div>
                    <div class="sparkle"></div>
                  </div>

                </div>
              </div>

              <div class="flex justify-between items-center">
                <div class="font-mono text-sm text-textMuted space-y-1">
                  <div class="flex items-center gap-2">
                    <i data-lucide="calendar-days" class="w-4 h-4"></i>
                    <span>Day
                      <span id="day-of-year" class="text-accent font-medium">0</span>
                      of
                      <span id="total-days" class="font-medium">365</span></span>
                  </div>
                  <div class="text-xs">
                    <span id="progress-text" class="text-textDim">Loading timeline...</span>
                  </div>
                </div>

                <div class="text-right">
                  <div id="days-remaining" class="font-mono text-lg font-medium text-textMain">
                    0 days
                  </div>
                  <div class="text-xs text-textMuted">remaining</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="space-y-3">
          <div class="flex items-center gap-3 justify-between">
            <img id="github-avatar"
              class="w-10 h-10 rounded-full border border-borderSubtle/60 hidden drop-shadow-[0_0_6px_rgba(245,158,11,0.18)]"
              alt="GitHub avatar" />
            <div class="flex-1 min-w-0">
              <div id="github-username-inline" class="text-[11px] text-textMain font-mono flex items-center gap-2">
                <i data-lucide="github"
                  class="w-3.5 h-3.5 text-textMain drop-shadow-[0_0_4px_rgba(255,255,255,0.35)]"></i>
                <span id="github-username-inline-text" class="truncate">Set GitHub in settings</span>
                <button id="github-refresh-inline" type="button"
                  class="p-1 rounded-full border border-borderSubtle hover:border-borderHover bg-white/5 text-textMuted hover:text-accent transition flex-shrink-0"
                  aria-label="Refresh GitHub contributions">
                  <i data-lucide="refresh-cw" class="w-3 h-3"></i>
                </button>
              </div>
              <div id="github-stats"
                class="text-xs text-textMain font-mono drop-shadow-[0_0_6px_rgba(245,158,11,0.25)]">
                Waiting for username
              </div>
              <div id="github-year-total" class="text-xs text-textMuted font-mono"></div>
            </div>
            <div class="gh-legend flex-shrink-0 text-xs">
              <span class="text-textDim">Less</span>
              <span class="gh-legend-swatch" style="background: rgba(255, 255, 255, 0.08)"></span>
              <span class="gh-legend-swatch" style="background: rgba(245, 158, 11, 0.28)"></span>
              <span class="gh-legend-swatch" style="background: rgba(245, 158, 11, 0.45)"></span>
              <span class="gh-legend-swatch" style="background: rgba(245, 158, 11, 0.62)"></span>
              <span class="gh-legend-swatch" style="background: rgba(245, 158, 11, 0.85)"></span>
              <span class="text-textDim">More</span>
            </div>
          </div>
          <div class="flex flex-col items-center gap-1 w-full pb-1">
            <div id="github-months" class="gh-grid text-[10px] text-textDim font-mono mb-1"></div>
            <div id="github-grid" class="gh-grid" aria-live="polite"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Enhanced Time Perspectives Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
      <!-- Month Card -->
      <div
        class="glass-card no-hover-raise rounded-xl p-5 md:p-6 flex flex-col justify-between h-36 group hover:scale-[1.02] transition-transform">
        <div class="flex justify-between items-start mb-4">
          <div class="space-y-1">
            <div class="flex items-center gap-2">
              <i data-lucide="calendar" class="w-4 h-4 text-textMuted"></i>
              <span class="text-sm font-medium text-textMuted">Month</span>
            </div>
            <span id="month-name" class="text-xs font-mono text-textDim uppercase tracking-wider">Loading...</span>
          </div>
          <span id="month-percent" class="text-2xl font-mono font-medium text-accent">0.0%</span>
        </div>
        <div class="space-y-2">
          <div class="w-full h-2.5 bg-white/5 rounded-full overflow-hidden">
            <div id="month-bar" class="h-full bg-accent/90 rounded-full transition-all duration-1000 ease-out w-0">
            </div>
          </div>
          <div class="flex justify-between text-xs text-textDim font-mono">
            <span>Day <span id="month-day">0</span></span>
            <span id="month-days-total">of 30</span>
          </div>
        </div>
      </div>

      <!-- Week Card -->
      <div
        class="glass-card rounded-xl p-5 md:p-6 flex flex-col justify-between h-36 group hover:scale-[1.02] transition-transform">
        <div class="flex justify-between items-start mb-4">
          <div class="space-y-1">
            <div class="flex items-center gap-2">
              <i data-lucide="trending-up" class="w-4 h-4 text-textMuted"></i>
              <span class="text-sm font-medium text-textMuted">Week</span>
            </div>
            <span class="text-xs font-mono text-textDim uppercase tracking-wider">Week <span
                id="week-number">0</span></span>
          </div>
          <span id="week-percent" class="text-2xl font-mono font-medium text-accent">0.0%</span>
        </div>
        <div class="space-y-2">
          <div class="w-full h-2.5 bg-white/5 rounded-full overflow-hidden">
            <div id="week-bar" class="h-full bg-accent/90 rounded-full transition-all duration-1000 ease-out w-0"></div>
          </div>
          <div class="flex justify-between text-xs text-textDim font-mono">
            <span id="week-day">Monday</span>
            <span id="week-progress">0/7 days</span>
          </div>
        </div>
      </div>

      <!-- Day Card -->
      <div class="glass-card no-hover-raise rounded-xl p-5 md:p-6 flex flex-col justify-between h-36">
        <div class="flex justify-between items-start mb-4">
          <div class="space-y-1">
            <div class="flex items-center gap-2">
              <i data-lucide="sun" class="w-4 h-4 text-textMuted"></i>
              <span class="text-sm font-medium text-textMuted">Day</span>
            </div>
            <span class="text-xs font-mono text-textDim uppercase tracking-wider">Today</span>
          </div>
          <span id="day-percent" class="text-2xl font-mono font-medium text-accent">0.0%</span>
        </div>
        <div class="space-y-2">
          <div class="w-full h-2.5 bg-white/5 rounded-full overflow-hidden">
            <div id="day-bar" class="h-full bg-accent/90 rounded-full transition-all duration-700 ease-out w-0"></div>
          </div>
          <div class="flex justify-between text-xs text-textDim font-mono">
            <span id="day-time">00:00</span>
            <span id="day-hours">0/24h</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Time Metrics Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
      <!-- Hours Metric -->
      <div
        class="glass-card rounded-xl p-5 md:p-6 flex flex-col justify-between h-36 group hover:scale-[1.02] transition-transform">
        <div class="flex justify-between items-start mb-4">
          <div class="space-y-1">
            <div class="flex items-center gap-2">
              <i data-lucide="clock-3" class="w-4 h-4 text-textMuted"></i>
              <span class="text-sm font-medium text-textMuted">Hours</span>
            </div>
            <span class="text-xs font-mono text-textDim uppercase tracking-wider">Elapsed</span>
          </div>
          <span id="hours-percent" class="text-xl font-mono font-semibold text-accent">0%</span>
        </div>
        <div class="space-y-2">
          <div class="w-full h-1.5 bg-white/5 rounded-full overflow-hidden">
            <div id="hours-bar" class="h-full bg-accent/80 rounded-full transition-all duration-700 ease-out w-0"></div>
          </div>
          <div class="flex justify-between text-xs text-textDim font-mono">
            <span><span id="hours-passed">0</span> used</span>
            <span>of <span id="hours-total">8760</span> hrs</span>
          </div>
        </div>
      </div>

      <!-- Minutes Metric -->
      <div
        class="glass-card rounded-xl p-5 md:p-6 flex flex-col justify-between h-36 group hover:scale-[1.02] transition-transform">
        <div class="flex justify-between items-start mb-4">
          <div class="space-y-1">
            <div class="flex items-center gap-2">
              <i data-lucide="activity" class="w-4 h-4 text-textMuted"></i>
              <span class="text-sm font-medium text-textMuted">Minutes</span>
            </div>
            <span class="text-xs font-mono text-textDim uppercase tracking-wider">Elapsed</span>
          </div>
          <span id="minutes-percent" class="text-xl font-mono font-semibold text-accent">0%</span>
        </div>
        <div class="space-y-2">
          <div class="w-full h-1.5 bg-white/5 rounded-full overflow-hidden">
            <div id="minutes-bar" class="h-full bg-accent/80 rounded-full transition-all duration-700 ease-out w-0">
            </div>
          </div>
          <div class="flex justify-between text-xs text-textDim font-mono">
            <span><span id="minutes-passed">0</span> used</span>
            <span>of <span id="minutes-total">525600</span> min</span>
          </div>
        </div>
      </div>

      <!-- Weeks Metric -->
      <div
        class="glass-card rounded-xl p-5 md:p-6 flex flex-col justify-between h-36 group hover:scale-[1.02] transition-transform">
        <div class="flex justify-between items-start mb-4">
          <div class="space-y-1">
            <div class="flex items-center gap-2">
              <i data-lucide="calendar-clock" class="w-4 h-4 text-textMuted"></i>
              <span class="text-sm font-medium text-textMuted">Weeks</span>
            </div>
            <span class="text-xs font-mono text-textDim uppercase tracking-wider">Completed</span>
          </div>
          <span id="weeks-percent" class="text-xl font-mono font-semibold text-accent">0%</span>
        </div>
        <div class="space-y-2">
          <div class="w-full h-1.5 bg-white/5 rounded-full overflow-hidden">
            <div id="weeks-bar" class="h-full bg-accent/80 rounded-full transition-all duration-700 ease-out w-0"></div>
          </div>
          <div class="flex justify-between text-xs text-textDim font-mono">
            <span><span id="weeks-passed">0</span> done</span>
            <span>of <span id="weeks-total">52</span> weeks</span>
          </div>
        </div>
      </div>

      <!-- Time Left Metric -->
      <div
        class="glass-card rounded-xl p-5 md:p-6 flex flex-col justify-between h-36 group hover:scale-[1.02] transition-transform">
        <div class="flex justify-between items-start mb-4">
          <div class="space-y-1">
            <div class="flex items-center gap-2">
              <i data-lucide="flag" class="w-4 h-4 text-textMuted"></i>
              <span class="text-sm font-medium text-textMuted">Time Left</span>
            </div>
            <span class="text-xs font-mono text-textDim uppercase tracking-wider">In the year</span>
          </div>
          <span id="percent-remaining" class="text-lg font-mono font-semibold text-accent">100%</span>
        </div>
        <div class="space-y-2">
          <div class="w-full h-1.5 bg-white/5 rounded-full overflow-hidden">
            <div id="remaining-bar"
              class="h-full bg-accent/80 rounded-full transition-all duration-700 ease-out w-full"></div>
          </div>
          <div class="flex justify-between text-xs text-textDim font-mono">
            <span id="remaining-days-card">0 days left</span>
            <span id="remaining-percent-text">100%</span>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div class="nightlight-control group fixed right-6 bottom-6 z-50 flex flex-col items-end gap-2">
    <div
      class="hidden group-hover:flex flex-col gap-3 glass-card rounded-xl p-4 border border-borderSubtle/60 bg-background/85 backdrop-blur-lg shadow-glow-sm min-w-[240px]">
      <div class="flex items-center justify-between gap-2">
        <span class="text-xs font-mono text-textMuted uppercase tracking-widest">Quick Settings</span>
      </div>
      <div class="space-y-2">
        <label class="flex items-center gap-2 text-xs text-textDim font-mono">
          <span class="w-20 text-textMuted">Name</span>
          <input id="settings-name"
            class="flex-1 bg-surface/70 border border-borderSubtle rounded-md px-2 py-1 text-xs text-textMain focus:outline-none focus:border-borderAccent"
            placeholder="Your name" />
          <button id="settings-save-name" type="button"
            class="px-2 py-1 rounded-md bg-accent/20 text-accent text-[11px] font-mono border border-borderAccent">
            Save
          </button>
        </label>
        <label class="flex items-center gap-2 text-xs text-textDim font-mono">
          <span class="w-20 text-textMuted">GitHub</span>
          <input id="settings-github"
            class="flex-1 bg-surface/70 border border-borderSubtle rounded-md px-2 py-1 text-xs text-textMain focus:outline-none focus:border-borderAccent"
            placeholder="username" />
          <button id="settings-save-github" type="button"
            class="px-2 py-1 rounded-md bg-accent/20 text-accent text-[11px] font-mono border border-borderAccent">
            Save
          </button>
        </label>
      </div>
      <div class="flex items-center justify-between gap-3 pt-1">
        <span class="text-xs font-mono text-textMuted uppercase tracking-widest">Night Light</span>
        <button id="nightlight-toggle" type="button" class="nightlight-toggle-btn glass-card text-xs text-textMuted"
          aria-pressed="false" aria-label="Toggle night light">
          <span class="nightlight-dot w-2 h-2 rounded-full bg-textDim transition-all duration-300"></span>
          <span id="nightlight-status" class="font-mono text-xs text-textDim uppercase tracking-widest">Off</span>
        </button>
      </div>
      <div class="flex items-center justify-between gap-3 pt-1">
        <span class="text-xs font-mono text-textMuted uppercase tracking-widest">AFK Mode</span>
        <button id="afk-toggle" type="button" class="nightlight-toggle-btn glass-card text-xs text-textMuted"
          aria-pressed="false" aria-label="Toggle AFK mode">
          <span class="afk-dot w-2 h-2 rounded-full bg-textDim transition-all duration-300"></span>
          <span id="afk-status" class="font-mono text-xs text-textDim uppercase tracking-widest">Off</span>
        </button>
      </div>
      <div class="flex items-center justify-between w-full gap-3">
        <span class="text-xs font-mono text-textMuted uppercase tracking-widest">Intensity</span>
        <span id="nightlight-level-value" class="text-xs font-mono text-textMain">30%</span>
      </div>
      <input id="nightlight-level" type="range" min="0" max="1" step="0.05" value="0.3"
        class="w-full accent-accent bg-surface/60 rounded-lg cursor-pointer" />
    </div>
    <button id="settings-button" type="button" class="nightlight-toggle-btn glass-card p-3 text-textMuted"
      aria-label="Open quick settings">
      <i data-lucide="settings" class="w-5 h-5"></i>
    </button>
  </div>

  <script>
    // Initialize Lucide Icons once
    lucide.createIcons();

    const IST_TIMEZONE = "Asia/Kolkata";
    const NAME_STORAGE_KEY = "yptUserName";
    const NIGHT_LIGHT_KEY = "yptNightLight";
    const NIGHT_LIGHT_LEVEL_KEY = "yptNightLightLevel";
    const GITHUB_USER_KEY = "yptGithubUser";
    const GH_API = "https://github-contributions-api.jogruber.de/v4";
    const GH_CACHE_STORE_KEY = "yptGithubCacheStore";
    const GH_AVATAR_KEY = "yptGithubAvatar";
    const AFK_MODE_KEY = "yptAfkMode";
    const AFK_TIMEOUT_MS = 5000; // 5 seconds grace period to move mouse away
    const GH_REFRESH_ICON_DEFAULT =
      '<i data-lucide="refresh-cw" class="w-3 h-3"></i>';
    const GH_REFRESH_ICON_SUCCESS =
      '<i data-lucide="check" class="w-3 h-3"></i>';

    let ghRefreshIconResetTimer = null;
    let githubDataLoaded = false; // Track if GitHub data was loaded

    let cachedUserName =
      (localStorage.getItem(NAME_STORAGE_KEY) || "").trim() || null;
    let nightLightEnabled = localStorage.getItem(NIGHT_LIGHT_KEY) === "true";
    let nightLightLevel = parseFloat(
      localStorage.getItem(NIGHT_LIGHT_LEVEL_KEY)
    );
    if (!isFinite(nightLightLevel)) nightLightLevel = 0.3;
    nightLightLevel = Math.min(1, Math.max(0, nightLightLevel));
    let cachedGithubUser =
      (localStorage.getItem(GITHUB_USER_KEY) || "").trim() || "";

    // AFK Mode state
    let afkModeEnabled = localStorage.getItem(AFK_MODE_KEY) === "true";
    let isCurrentlyAfk = false;
    let afkMessageShowing = false; // Track if AFK message is currently displayed
    let afkTimeoutId = null;
    let lastActivityTime = Date.now();
    let afkActivationTime = 0; // Track when AFK was activated to add grace period
    let afkTypingIntervalId = null; // Track typing animation interval

    // Cached DOM element references (populated on DOMContentLoaded)
    const DOM = {};

    // Cache DOM elements for performance (avoids repeated lookups)
    function cacheDOMElements() {
      const ids = [
        'current-time', 'current-date', 'current-year', 'year-percent', 'year-bar',
        'day-of-year', 'total-days', 'days-remaining', 'progress-text',
        'month-name', 'month-percent', 'month-bar', 'month-day', 'month-days-total',
        'week-number', 'week-percent', 'week-bar', 'week-day', 'week-progress',
        'day-percent', 'day-bar', 'day-time', 'day-hours',
        'hours-passed', 'hours-total', 'hours-percent', 'hours-bar',
        'minutes-passed', 'minutes-total', 'minutes-percent', 'minutes-bar',
        'weeks-passed', 'weeks-total', 'weeks-percent', 'weeks-bar',
        'percent-remaining', 'remaining-bar', 'remaining-days-card', 'remaining-percent-text',
        'greeting', 'github-stats', 'github-grid', 'github-months', 'github-avatar',
        'github-year-total', 'github-username-label', 'github-username-inline',
        'github-username-inline-text', 'github-refresh-inline', 'nightlight-toggle',
        'nightlight-status', 'nightlight-overlay', 'nightlight-level', 'nightlight-level-value',
        'settings-name', 'settings-save-name', 'settings-github', 'settings-save-github'
      ];
      ids.forEach(id => { DOM[id] = document.getElementById(id); });
      DOM.main = document.querySelector('main');
    }

    // Safe element access helper using cached DOM
    function $(id) {
      return DOM[id] || document.getElementById(id);
    }

    function setText(id, text) {
      const el = $(id);
      if (el) el.textContent = text;
    }

    function setWidth(id, percent) {
      const el = $(id);
      if (el) el.style.width = percent + "%";
    }

    // Utility functions
    function isLeapYear(year) {
      return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
    }

    function getDayOfYear(date) {
      const start = new Date(date.getFullYear(), 0, 0);
      const diff = date - start;
      const oneDay = 1000 * 60 * 60 * 24;
      return Math.floor(diff / oneDay);
    }

    function getWeekNumber(date) {
      const d = new Date(
        Date.UTC(date.getFullYear(), date.getMonth(), date.getDate())
      );
      const dayNum = d.getUTCDay() || 7;
      d.setUTCDate(d.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      return Math.ceil(((d - yearStart) / 86400000 + 1) / 7);
    }

    function getDayOfWeekName(dayIndex) {
      const days = [
        "Sunday",
        "Monday",
        "Tuesday",
        "Wednesday",
        "Thursday",
        "Friday",
        "Saturday",
      ];
      return days[dayIndex];
    }

    function getProgressDescription(percentage) {
      if (percentage < 10) return "Fresh canvas awaits your story";
      if (percentage < 25) return "Seeds of potential taking root";
      if (percentage < 50) return "Building momentum, halfway in sight";
      if (percentage < 75) return "Past the peak, cruising forward";
      if (percentage < 90) return "The finish line draws near";
      if (percentage < 99) return "Final moments of the journey";
      return "A chapter closing, new one awaits";
    }

    function formatPercentage(value, decimals = 4) {
      return value.toFixed(decimals) + "%";
    }

    function getGreetingPrefix(hour) {
      if (hour >= 5 && hour < 12) return "Good Morning";
      if (hour >= 12 && hour < 17) return "Good Afternoon";
      if (hour >= 17 && hour < 21) return "Good Evening";
      return "Good Night";
    }

    // Custom Modal System
    let modalResolve = null;

    function showCustomModal(options) {
      return new Promise((resolve) => {
        const overlay = document.getElementById('custom-modal-overlay');
        const titleEl = document.getElementById('modal-title');
        const subtitleEl = document.getElementById('modal-subtitle');
        const inputEl = document.getElementById('modal-input');
        const iconContainer = document.getElementById('modal-icon');
        const submitBtn = document.getElementById('modal-submit');
        const cancelBtn = document.getElementById('modal-cancel');

        if (!overlay) {
          resolve(null);
          return;
        }

        // Configure modal
        titleEl.textContent = options.title || 'Enter Information';
        subtitleEl.textContent = options.subtitle || 'Please fill in the field below';
        inputEl.placeholder = options.placeholder || 'Enter here...';
        inputEl.value = options.defaultValue || '';

        // Update icon
        const iconName = options.icon || 'user';
        iconContainer.innerHTML = `<i data-lucide="${iconName}" class="w-6 h-6"></i>`;
        lucide.createIcons();

        // Store resolve function
        modalResolve = resolve;

        // Show modal
        overlay.classList.add('active');
        setTimeout(() => inputEl.focus(), 100);

        // Handle submit
        const handleSubmit = () => {
          const value = inputEl.value.trim();
          overlay.classList.remove('active');
          modalResolve = null;
          resolve(value || null);
        };

        // Handle cancel
        const handleCancel = () => {
          overlay.classList.remove('active');
          modalResolve = null;
          resolve(null);
        };

        // Handle Enter key
        const handleKeydown = (e) => {
          if (e.key === 'Enter') {
            handleSubmit();
            inputEl.removeEventListener('keydown', handleKeydown);
          } else if (e.key === 'Escape') {
            handleCancel();
            inputEl.removeEventListener('keydown', handleKeydown);
          }
        };

        // Remove old listeners and add new ones
        submitBtn.onclick = handleSubmit;
        cancelBtn.onclick = handleCancel;
        inputEl.addEventListener('keydown', handleKeydown);
      });
    }

    async function requestUserName() {
      const input = await showCustomModal({
        title: 'Welcome! 👋',
        subtitle: 'What should we call you?',
        placeholder: 'Enter your name',
        icon: 'user'
      });

      if (!input) return null;
      cachedUserName = input;
      localStorage.setItem(NAME_STORAGE_KEY, cachedUserName);
      return cachedUserName;
    }

    function getUserName() {
      return cachedUserName;
    }

    async function promptForUserName() {
      if (cachedUserName) return cachedUserName;
      return await requestUserName();
    }

    async function requestGithubUser() {
      const input = await showCustomModal({
        title: 'GitHub Profile',
        subtitle: 'Enter your GitHub username to show contributions',
        placeholder: 'username',
        icon: 'github'
      });

      if (!input) return null;
      cachedGithubUser = input;
      localStorage.setItem(GITHUB_USER_KEY, cachedGithubUser);
      return cachedGithubUser;
    }

    function getGithubUser(forcePrompt = false) {
      if (forcePrompt || !cachedGithubUser) {
        // Don't prompt synchronously anymore - handled separately
        return cachedGithubUser || null;
      }
      return cachedGithubUser;
    }

    async function applyGithubData(username, data) {
      const statsEl = document.getElementById("github-stats");
      const gridEl = document.getElementById("github-grid");
      const monthsEl = document.getElementById("github-months");
      const avatarEl = document.getElementById("github-avatar");
      const yearTotalEl = document.getElementById("github-year-total");

      const year = new Date().getFullYear();
      let contribs = [];
      let total = 0;

      if (Array.isArray(data?.years)) {
        const yearData = data.years.find((y) => Number(y.year) === year);
        if (yearData && Array.isArray(yearData.contributions)) {
          contribs = yearData.contributions;
          total =
            yearData.total ||
            contribs.reduce((sum, c) => sum + (c.count || 0), 0);
        }
      }

      if (!contribs.length && Array.isArray(data?.contributions)) {
        contribs = data.contributions.filter(
          (c) => new Date(c.date).getFullYear() === year
        );
        total =
          (data.total && (data.total[String(year)] || data.total[year])) ??
          contribs.reduce((sum, c) => sum + (c.count || 0), 0);
      }

      if (!contribs.length) throw new Error("No data for this year");

      const yearStart = new Date(year, 0, 1);
      const startDay = yearStart.getDay(); // 0 Sunday
      const startOffset = startDay;
      const daysInYear = isLeapYear(year) ? 366 : 365;

      // Build map for quick lookup
      const contribMap = new Map();
      contribs.forEach((c) => contribMap.set(c.date, c.count || 0));

      // Build complete weeks grid (including zero days)
      const weeks = [];
      let maxCount = 0;
      for (let i = 0; i < daysInYear; i++) {
        const d = new Date(yearStart);
        d.setDate(yearStart.getDate() + i);
        const iso = d.toISOString().slice(0, 10);
        const count = contribMap.get(iso) || 0;
        if (count > maxCount) maxCount = count;
        const daysFromStart = i + startOffset;
        const weekIndex = Math.floor(daysFromStart / 7);
        const dayIndex = d.getDay();
        if (!weeks[weekIndex]) weeks[weekIndex] = Array(7).fill(null);
        weeks[weekIndex][dayIndex] = { date: iso, count };
      }
      if (maxCount === 0) maxCount = 1;

      const colors = [
        "rgba(255, 255, 255, 0.08)",
        "rgba(245, 158, 11, 0.28)",
        "rgba(245, 158, 11, 0.45)",
        "rgba(245, 158, 11, 0.62)",
        "rgba(245, 158, 11, 0.85)",
      ];

      const getColor = (count) => {
        if (!count) return colors[0];
        // Favor showing low counts distinctly instead of fading into gray
        if (count <= 2) return colors[1];
        const ratio = maxCount ? count / maxCount : 0;
        if (ratio > 0.75) return colors[4];
        if (ratio > 0.55) return colors[3];
        if (ratio > 0.35) return colors[2];
        return colors[1];
      };

      const columnTemplate =
        weeks.length > 0 ? `repeat(${weeks.length}, 12px)` : "";

      if (gridEl) {
        if (columnTemplate) {
          gridEl.style.gridTemplateColumns = columnTemplate;
          gridEl.style.gridAutoFlow = "column";
        }
        gridEl.innerHTML = weeks
          .map((week) => {
            const cells = (week || [])
              .map((c, idx) => {
                const count = c?.count || 0;
                const date = c?.date || "";
                const color = getColor(count);
                return `<div class="gh-cell" style="background:${color}" title="${date || "No data"
                  } - ${count} contributions"></div>`;
              })
              .join("");
            return `<div class="gh-week">${cells}</div>`;
          })
          .join("");
      }

      if (monthsEl) {
        const monthLabels = new Array(weeks.length).fill("");
        for (let m = 0; m < 12; m++) {
          const firstDay = new Date(year, m, 1);
          const daysFromStart =
            Math.floor((firstDay - yearStart) / (1000 * 60 * 60 * 24)) +
            startOffset;
          const idx = Math.floor(daysFromStart / 7);
          if (idx >= 0 && idx < monthLabels.length) {
            monthLabels[idx] = firstDay.toLocaleString("en", {
              month: "short",
            });
          }
        }

        if (columnTemplate) {
          monthsEl.style.gridTemplateColumns = columnTemplate;
          monthsEl.style.gridAutoFlow = "column";
        }
        monthsEl.innerHTML = monthLabels
          .map(
            (label) =>
              `<div class="gh-month-cell text-[10px] text-textDim font-mono">${label || ""
              }</div>`
          )
          .join("");
      }

      if (statsEl) statsEl.textContent = `${year}: ${total} contributions`;
      if (yearTotalEl) yearTotalEl.textContent = "";

      if (avatarEl) {
        // Try loading from cache first
        const cachedAvatar = localStorage.getItem(GH_AVATAR_KEY);
        const cachedAvatarUser = localStorage.getItem(GH_AVATAR_KEY + "_user");

        if (cachedAvatar && cachedAvatarUser === username) {
          // Use cached avatar immediately
          avatarEl.src = cachedAvatar;
          avatarEl.alt = `${username}'s avatar`;
          avatarEl.classList.remove("hidden");
        } else {
          // Fetch from API and cache
          try {
            const profileResp = await fetch(
              `https://api.github.com/users/${encodeURIComponent(username)}`,
              { cache: "no-store" }
            );
            if (profileResp.ok) {
              const profile = await profileResp.json();
              if (profile.avatar_url) {
                avatarEl.src = profile.avatar_url;
                avatarEl.alt = `${username}'s avatar`;
                avatarEl.classList.remove("hidden");
                // Cache the avatar URL
                localStorage.setItem(GH_AVATAR_KEY, profile.avatar_url);
                localStorage.setItem(GH_AVATAR_KEY + "_user", username);
              }
            }
          } catch (e) {
            avatarEl.classList.add("hidden");
          }
        }
      }
    }

    function getCachedGithubData(username, year) {
      try {
        const raw = localStorage.getItem(GH_CACHE_STORE_KEY);
        if (!raw) return null;
        const parsed = JSON.parse(raw);
        const key = `${username}:${year}`;
        return parsed[key] || null;
      } catch (e) {
        return null;
      }
    }

    function setCachedGithubData(username, year, data) {
      try {
        const raw = localStorage.getItem(GH_CACHE_STORE_KEY);
        const parsed = raw ? JSON.parse(raw) : {};
        const key = `${username}:${year}`;
        parsed[key] = { data, cachedAt: Date.now() };
        localStorage.setItem(GH_CACHE_STORE_KEY, JSON.stringify(parsed));
      } catch (e) {
        // Ignore cache write errors
      }
    }

    function showGithubRefreshSuccess() {
      const btn = $("github-refresh-inline");
      if (!btn) return;
      btn.innerHTML = GH_REFRESH_ICON_SUCCESS;
      lucide.createIcons({ nodes: [btn] }); // Only update this button
      if (ghRefreshIconResetTimer) {
        clearTimeout(ghRefreshIconResetTimer);
      }
      ghRefreshIconResetTimer = setTimeout(() => {
        const resetBtn = $("github-refresh-inline");
        if (resetBtn) {
          resetBtn.innerHTML = GH_REFRESH_ICON_DEFAULT;
          lucide.createIcons({ nodes: [resetBtn] }); // Only update this button
        }
      }, 1000);
    }

    function updateGreeting() {
      const greetingEl = document.getElementById("greeting");
      if (!greetingEl) return;

      const name = getUserName();
      if (!name) {
        greetingEl.textContent = "Welcome!";
        return;
      }

      const hourFormatter = new Intl.DateTimeFormat("en-US", {
        hour: "numeric",
        hour12: false,
        timeZone: IST_TIMEZONE,
      });
      const hour = parseInt(hourFormatter.format(new Date()), 10);
      const greetingText = getGreetingPrefix(isNaN(hour) ? 0 : hour);

      // Check if AFK mode is enabled and user is currently AFK
      if (afkModeEnabled && isCurrentlyAfk) {
        // Only start typing if not already showing
        if (!afkMessageShowing) {
          afkMessageShowing = true;
          // Start the typing animation
          startAfkTypingAnimation(name);
        }
      } else {
        // Reset flag and show normal greeting
        if (afkMessageShowing || greetingEl.textContent !== `${greetingText}, ${name}`) {
          afkMessageShowing = false;
          stopAfkTypingAnimation();
          greetingEl.textContent = `${greetingText}, ${name}`;
        }
      }
    }

    // Letter-by-letter typing animation
    function startAfkTypingAnimation(name) {
      const greetingEl = document.getElementById("greeting");
      if (!greetingEl) return;

      const fullText = `${name} is afk...`;
      let currentIndex = 0;
      let isTyping = true; // true = typing, false = erasing

      // Clear any existing animation
      stopAfkTypingAnimation();

      // Create the typing element
      greetingEl.innerHTML = '<span class="afk-container"><span class="typing-text"></span></span>';
      const typingEl = greetingEl.querySelector('.typing-text');

      function animateTyping() {
        if (!afkModeEnabled || !isCurrentlyAfk) {
          stopAfkTypingAnimation();
          return;
        }

        if (isTyping) {

          if (currentIndex <= fullText.length) {
            typingEl.textContent = fullText.substring(0, currentIndex);
            currentIndex++;

            afkTypingIntervalId = setTimeout(animateTyping, 200);
          } else {

            afkTypingIntervalId = setTimeout(() => {
              isTyping = false;
              currentIndex = fullText.length;
              animateTyping();
            }, 2000);
          }
        } else {

          if (currentIndex >= 0) {
            typingEl.textContent = fullText.substring(0, currentIndex);
            currentIndex--;

            afkTypingIntervalId = setTimeout(animateTyping, 150);
          } else {

            afkTypingIntervalId = setTimeout(() => {
              isTyping = true;
              currentIndex = 0;
              animateTyping();
            }, 500);
          }
        }
      }


      animateTyping();
    }

    function stopAfkTypingAnimation() {
      if (afkTypingIntervalId) {
        clearTimeout(afkTypingIntervalId);
        afkTypingIntervalId = null;
      }
    }

    // AFK Mode Functions
    function applyAfkModeState() {
      const toggle = document.getElementById("afk-toggle");
      const status = document.getElementById("afk-status");
      const dot = toggle ? toggle.querySelector(".afk-dot") : null;

      if (toggle) {
        toggle.setAttribute("aria-pressed", afkModeEnabled ? "true" : "false");
        toggle.classList.toggle("nightlight-toggle-active", afkModeEnabled);
      }

      if (status) {
        status.textContent = afkModeEnabled ? "On" : "Off";
      }

      if (dot) {
        if (afkModeEnabled) {
          dot.style.background = "#f59e0b";
          dot.style.boxShadow = "0 0 10px rgba(245, 158, 11, 0.8)";
        } else {
          dot.style.background = "";
          dot.style.boxShadow = "";
        }
      }

      if (!afkModeEnabled && isCurrentlyAfk) {
        isCurrentlyAfk = false;
        updateGreeting();
      }

      if (afkModeEnabled) {
        startAfkMonitoring();
      } else {
        stopAfkMonitoring();
      }
    }

    function toggleAfkMode() {
      afkModeEnabled = !afkModeEnabled;
      localStorage.setItem(AFK_MODE_KEY, afkModeEnabled);

      if (afkModeEnabled) {
        isCurrentlyAfk = true;
        afkMessageShowing = false;
        afkActivationTime = Date.now();
        updateGreeting();
      }

      applyAfkModeState();
    }

    function triggerAfkState() {
      if (!afkModeEnabled || isCurrentlyAfk) return;
      isCurrentlyAfk = true;
      updateGreeting();
    }

    function clearAfkState() {
      if (!isCurrentlyAfk) return;
      isCurrentlyAfk = false;
      afkMessageShowing = false;
      afkModeEnabled = false;
      localStorage.setItem(AFK_MODE_KEY, afkModeEnabled);
      updateGreeting();
      applyAfkModeState();
    }

    function resetAfkTimer() {
      lastActivityTime = Date.now();
      if (afkTimeoutId) {
        clearTimeout(afkTimeoutId);
      }
      if (afkModeEnabled) {
        afkTimeoutId = setTimeout(triggerAfkState, AFK_TIMEOUT_MS);
      }
    }

    function handleUserActivity() {
      lastActivityTime = Date.now();
      if (isCurrentlyAfk && afkModeEnabled) {
        if (Date.now() - afkActivationTime > 1000) {
          clearAfkState();
        }
      }
    }

    function startAfkMonitoring() {
      if (afkTimeoutId) {
        clearTimeout(afkTimeoutId);
      }

      lastActivityTime = Date.now();
      afkTimeoutId = setTimeout(triggerAfkState, AFK_TIMEOUT_MS);

      const activityEvents = ['mousemove', 'mousedown', 'keydown', 'touchstart', 'scroll', 'click'];
      activityEvents.forEach(event => {
        document.addEventListener(event, handleUserActivity, { passive: true });
      });
    }

    function stopAfkMonitoring() {
      // Clear timer
      if (afkTimeoutId) {
        clearTimeout(afkTimeoutId);
        afkTimeoutId = null;
      }

      // Remove activity listeners
      const activityEvents = ['mousemove', 'mousedown', 'keydown', 'touchstart', 'scroll', 'click'];
      activityEvents.forEach(event => {
        document.removeEventListener(event, handleUserActivity);
      });
    }

    function applyNightLightState() {
      const isActive = !!nightLightEnabled;
      document.body.classList.toggle("nightlight-active", isActive);
      const toggle = document.getElementById("nightlight-toggle");
      const status = document.getElementById("nightlight-status");
      const overlay = document.getElementById("nightlight-overlay");
      const mainEl = document.querySelector("main");

      if (toggle) {
        toggle.setAttribute("aria-pressed", isActive ? "true" : "false");
        toggle.classList.toggle("nightlight-toggle-active", isActive);
      }

      if (status) {
        status.textContent = isActive ? "On" : "Off";
      }

      if (overlay) {
        overlay.style.opacity = isActive ? nightLightLevel.toFixed(2) : "0";
      }

      if (mainEl) {
        mainEl.style.filter = isActive
          ? `sepia(${(0.5 * nightLightLevel).toFixed(
            2
          )}) hue-rotate(-8deg) brightness(${(
            1 -
            nightLightLevel * 0.15
          ).toFixed(2)})`
          : "";
      }
    }

    async function loadGithubContributions(forcePrompt = false) {
      const username = getGithubUser(forcePrompt);
      const statsEl = document.getElementById("github-stats");
      const gridEl = document.getElementById("github-grid");
      const monthsEl = document.getElementById("github-months");
      const labelEl = document.getElementById("github-username-label");
      const inlineLabelEl = document.getElementById("github-username-inline");
      const inlineLabelText = document.getElementById(
        "github-username-inline-text"
      );
      const avatarEl = document.getElementById("github-avatar");
      const yearTotalEl = document.getElementById("github-year-total");
      if (labelEl) {
        labelEl.textContent = username ? `@${username}` : "";
      }
      if (inlineLabelEl) {
        if (inlineLabelText) {
          inlineLabelText.textContent = username
            ? `@${username}`
            : "Set GitHub in settings";
          inlineLabelText.classList.toggle("text-textMain", !!username);
          inlineLabelText.classList.toggle("text-textDim", !username);
        }
      }

      if (!username) {
        if (statsEl)
          statsEl.textContent =
            "Set your GitHub username to load contributions.";
        if (inlineLabelText)
          inlineLabelText.textContent = "Set GitHub in settings";
        if (gridEl) gridEl.innerHTML = "";
        if (monthsEl) monthsEl.innerHTML = "";
        if (avatarEl) avatarEl.classList.add("hidden");
        if (yearTotalEl) yearTotalEl.textContent = "";
        return;
      }

      if (statsEl) statsEl.textContent = "Loading contributions...";
      if (gridEl) gridEl.innerHTML = "";
      if (monthsEl) monthsEl.innerHTML = "";

      const currentYear = new Date().getFullYear();
      const cachedEntry = getCachedGithubData(username, currentYear);

      if (cachedEntry?.data) {
        try {
          await applyGithubData(username, cachedEntry.data);
        } catch (e) {
          // Ignore cache rendering errors; we'll try live fetch next
        }
      }

      try {
        const resp = await fetch(`${GH_API}/${encodeURIComponent(username)}`, {
          cache: "no-store",
        });
        if (!resp.ok) throw new Error("Network error");
        const data = await resp.json();
        await applyGithubData(username, data);
        setCachedGithubData(username, currentYear, data);
        showGithubRefreshSuccess();
      } catch (err) {
        if (cachedEntry?.data) {
          if (statsEl)
            statsEl.textContent =
              "Using cached contributions; latest fetch failed.";
          return;
        }
        if (statsEl)
          statsEl.textContent =
            "Could not load contributions. Check username or try again.";
        if (gridEl) gridEl.innerHTML = "";
        if (yearTotalEl) yearTotalEl.textContent = "";
        const avatarEl = document.getElementById("github-avatar");
        if (avatarEl) avatarEl.classList.add("hidden");
      }
    }

    function toggleNightLight() {
      nightLightEnabled = !nightLightEnabled;
      localStorage.setItem(NIGHT_LIGHT_KEY, nightLightEnabled);
      applyNightLightState();
    }

    // DOM update functions (using cached DOM references for performance)
    function updateTime() {
      const now = new Date();
      const year = now.getFullYear();

      // Update clock
      const timeString = now.toLocaleTimeString("en-IN", {
        hour: "numeric",
        minute: "2-digit",
        second: "2-digit",
        hour12: true,
        timeZone: IST_TIMEZONE,
      });
      const dateString = now.toLocaleDateString("en-IN", {
        weekday: "long",
        month: "long",
        day: "numeric",
        year: "numeric",
        timeZone: IST_TIMEZONE,
      });

      if (DOM['current-time']) DOM['current-time'].textContent = timeString;
      if (DOM['current-date']) DOM['current-date'].textContent = dateString;

      // Year calculations
      if (DOM['current-year']) DOM['current-year'].textContent = year;

      const startOfYear = new Date(year, 0, 1);
      const endOfYear = new Date(year + 1, 0, 1);
      const totalYearMs = endOfYear - startOfYear;
      const elapsedYearMs = now - startOfYear;
      const yearPercent = (elapsedYearMs / totalYearMs) * 100;

      const daysInYear = isLeapYear(year) ? 366 : 365;
      const dayOfYear = getDayOfYear(now);
      const daysLeft = daysInYear - dayOfYear;
      const dayPercentage = ((1 / daysInYear) * 100).toFixed(2);

      // Update year progress (using cached DOM)
      if (DOM['year-percent']) DOM['year-percent'].textContent = formatPercentage(yearPercent);
      if (DOM['year-bar']) DOM['year-bar'].style.width = yearPercent + "%";
      if (DOM['day-of-year']) DOM['day-of-year'].textContent = dayOfYear;
      if (DOM['total-days']) DOM['total-days'].textContent = daysInYear;
      if (DOM['days-remaining']) DOM['days-remaining'].textContent = `${daysLeft} days`;
      if (DOM['progress-text']) DOM['progress-text'].textContent = getProgressDescription(yearPercent);

      // Month calculations
      const startOfMonth = new Date(year, now.getMonth(), 1);
      const endOfMonth = new Date(year, now.getMonth() + 1, 1);
      const totalMonthMs = endOfMonth - startOfMonth;
      const elapsedMonthMs = now - startOfMonth;
      const monthPercent = (elapsedMonthMs / totalMonthMs) * 100;
      const monthName = now.toLocaleDateString("en-US", { month: "long" });
      const monthDay = now.getDate();
      const monthDays = new Date(year, now.getMonth() + 1, 0).getDate();

      if (DOM['month-name']) DOM['month-name'].textContent = monthName;
      if (DOM['month-percent']) DOM['month-percent'].textContent = formatPercentage(monthPercent, 1);
      if (DOM['month-bar']) DOM['month-bar'].style.width = monthPercent + "%";
      if (DOM['month-day']) DOM['month-day'].textContent = monthDay;
      if (DOM['month-days-total']) DOM['month-days-total'].textContent = `of ${monthDays}`;

      // Week calculations
      const startOfWeek = new Date(now);
      startOfWeek.setHours(0, 0, 0, 0);
      startOfWeek.setDate(now.getDate() - now.getDay());

      const endOfWeek = new Date(startOfWeek);
      endOfWeek.setDate(startOfWeek.getDate() + 7);

      const totalWeekMs = endOfWeek - startOfWeek;
      const elapsedWeekMs = now - startOfWeek;
      const weekPercent = (elapsedWeekMs / totalWeekMs) * 100;
      const weekNumber = getWeekNumber(now);
      const weekDay = now.getDay();

      if (DOM['week-number']) DOM['week-number'].textContent = weekNumber;
      if (DOM['week-percent']) DOM['week-percent'].textContent = formatPercentage(weekPercent, 1);
      if (DOM['week-bar']) DOM['week-bar'].style.width = weekPercent + "%";
      if (DOM['week-day']) DOM['week-day'].textContent = getDayOfWeekName(weekDay);
      if (DOM['week-progress']) DOM['week-progress'].textContent = `${weekDay + 1}/7 days`;

      // Day calculations
      const startOfDay = new Date(year, now.getMonth(), now.getDate());
      const endOfDay = new Date(year, now.getMonth(), now.getDate() + 1);
      const totalDayMs = endOfDay - startOfDay;
      const elapsedDayMs = now - startOfDay;
      const dayPercent = (elapsedDayMs / totalDayMs) * 100;
      const hours = now.getHours().toString().padStart(2, "0");
      const minutes = now.getMinutes().toString().padStart(2, "0");

      if (DOM['day-percent']) DOM['day-percent'].textContent = formatPercentage(dayPercent, 1);
      if (DOM['day-bar']) DOM['day-bar'].style.width = dayPercent + "%";
      if (DOM['day-time']) DOM['day-time'].textContent = `${hours}:${minutes}`;
      if (DOM['day-hours']) DOM['day-hours'].textContent = `${hours}/24h`;

      // Time metrics
      const hoursPassed = Math.floor(elapsedYearMs / (1000 * 60 * 60));
      const minutesPassed = Math.floor(elapsedYearMs / (1000 * 60));
      const weeksPassed = Math.floor(dayOfYear / 7);
      const totalHours = daysInYear * 24;
      const totalMinutes = totalHours * 60;
      const totalWeeks = Math.ceil(daysInYear / 7);
      const hoursPercent = (hoursPassed / totalHours) * 100;
      const minutesPercent = (minutesPassed / totalMinutes) * 100;
      const weeksPercent = (weeksPassed / totalWeeks) * 100;
      const remainingPercent = Math.max(0, 100 - yearPercent);

      if (DOM['hours-passed']) DOM['hours-passed'].textContent = hoursPassed.toLocaleString();
      if (DOM['hours-total']) DOM['hours-total'].textContent = totalHours.toLocaleString();
      if (DOM['hours-percent']) DOM['hours-percent'].textContent = formatPercentage(hoursPercent, 1);
      if (DOM['hours-bar']) DOM['hours-bar'].style.width = `${Math.min(100, Math.max(0, hoursPercent))}%`;

      if (DOM['minutes-passed']) DOM['minutes-passed'].textContent = minutesPassed.toLocaleString();
      if (DOM['minutes-total']) DOM['minutes-total'].textContent = totalMinutes.toLocaleString();
      if (DOM['minutes-percent']) DOM['minutes-percent'].textContent = formatPercentage(minutesPercent, 1);
      if (DOM['minutes-bar']) DOM['minutes-bar'].style.width = `${Math.min(100, Math.max(0, minutesPercent))}%`;

      if (DOM['weeks-passed']) DOM['weeks-passed'].textContent = weeksPassed;
      if (DOM['weeks-total']) DOM['weeks-total'].textContent = totalWeeks;
      if (DOM['weeks-percent']) DOM['weeks-percent'].textContent = formatPercentage(weeksPercent, 1);
      if (DOM['weeks-bar']) DOM['weeks-bar'].style.width = `${Math.min(100, Math.max(0, weeksPercent))}%`;

      if (DOM['percent-remaining']) DOM['percent-remaining'].textContent = remainingPercent.toFixed(2) + "%";
      if (DOM['remaining-bar']) DOM['remaining-bar'].style.width = `${Math.min(100, Math.max(0, remainingPercent))}%`;
      if (DOM['remaining-days-card']) DOM['remaining-days-card'].textContent = `${daysLeft} days left`;
      if (DOM['remaining-percent-text']) DOM['remaining-percent-text'].textContent = remainingPercent.toFixed(2) + "%";

      updateGreeting();
    }

    function updateTitle() {
      const now = new Date();
      const year = now.getFullYear();
      const startOfYear = new Date(year, 0, 1);
      const endOfYear = new Date(year + 1, 0, 1);
      const percent = (
        ((now - startOfYear) / (endOfYear - startOfYear)) *
        100
      ).toFixed(4);
      document.title = `${percent}% - Year Progress Tracker`;
    }



    // Initialize
    document.addEventListener("DOMContentLoaded", async () => {
      cacheDOMElements();

      applyNightLightState();
      const levelInput = DOM['nightlight-level'];
      const levelValue = DOM['nightlight-level-value'];
      if (levelInput && levelValue) {
        levelInput.value = nightLightLevel;
        levelValue.textContent = `${Math.round(nightLightLevel * 100)}%`;
        levelInput.addEventListener("input", (e) => {
          const val = parseFloat(e.target.value);
          if (isFinite(val)) {
            nightLightLevel = Math.min(1, Math.max(0, val));
            localStorage.setItem(NIGHT_LIGHT_LEVEL_KEY, nightLightLevel);
            levelValue.textContent = `${Math.round(nightLightLevel * 100)}%`;
            if (nightLightEnabled) applyNightLightState();
          }
        });
      }

      const nameInput = DOM['settings-name'];
      const nameSave = DOM['settings-save-name'];
      if (nameInput) nameInput.value = cachedUserName || "";
      if (nameSave && nameInput) {
        nameSave.addEventListener("click", () => {
          const val = nameInput.value.trim();
          if (!val) return;
          cachedUserName = val;
          localStorage.setItem(NAME_STORAGE_KEY, cachedUserName);
          updateGreeting();
        });
      }

      const githubInput = DOM['settings-github'];
      const githubSave = DOM['settings-save-github'];
      if (githubInput) githubInput.value = cachedGithubUser || "";
      if (githubSave && githubInput) {
        githubSave.addEventListener("click", async () => {
          const val = githubInput.value.trim();
          if (!val) return;
          cachedGithubUser = val;
          localStorage.setItem(GITHUB_USER_KEY, cachedGithubUser);
          await loadGithubContributions(false);
        });
      }

      // Initial UI updates
      updateTime();
      updateTitle();

      if (!cachedUserName) {
        await new Promise(r => setTimeout(r, 500));
        const name = await requestUserName();
        if (name) {
          updateGreeting();
          if (nameInput) nameInput.value = name;

          // Now ask for GitHub if not set
          if (!cachedGithubUser) {
            await new Promise(r => setTimeout(r, 300));
            const github = await requestGithubUser();
            if (github) {
              if (githubInput) githubInput.value = github;
              await loadGithubContributions(false);
            }
          }
        }
      }

      // Load GitHub contributions
      await loadGithubContributions();

      const nightlightToggleBtn =
        document.getElementById("nightlight-toggle");
      if (nightlightToggleBtn) {
        nightlightToggleBtn.addEventListener("click", () =>
          toggleNightLight()
        );
      }

      // AFK Mode initialization
      const afkToggleBtn = document.getElementById("afk-toggle");
      if (afkToggleBtn) {
        afkToggleBtn.addEventListener("click", () => toggleAfkMode());
      }
      applyAfkModeState();

      const ghRefresh = document.getElementById("github-refresh");
      const ghRefreshInline = document.getElementById(
        "github-refresh-inline"
      );

      const handleGhRefresh = () => loadGithubContributions(false);

      if (ghRefresh) {
        ghRefresh.addEventListener("click", handleGhRefresh);
      }
      if (ghRefreshInline) {
        ghRefreshInline.addEventListener("click", handleGhRefresh);
      }

      setInterval(updateTime, 1000);
      setInterval(updateTitle, 60000);

      const elements = document.querySelectorAll(
        ".animate-fade-in, .animate-slide-up"
      );
      elements.forEach((el, index) => {
        el.style.animationDelay = `${index * 0.1}s`;
      });
    });
  </script>
</body>

</html>
